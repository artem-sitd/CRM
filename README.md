`python -m venv crm_venv` для window\
`crm_venv/scripts/activate`


`python3 -m venv crm_venv` для unix систем\
`crm_venv/bin/activate`


`pip install -r requirements.txt`

`python manage.py makemigrations`

`python manage.py migrate`

Если не планируется использовать дамп базы:\
`python manage.py create_groups`

Последняя команда создаст:

1. Администратора (crm_admin1),
2. оператора (operator),
3. менеджера (manager),
4. маркетолога (marketer). У всех пароли: `123`
5. Добавит их в группы: 'Admins', 'Operators', 'Marketers', 'Managers'
6. Добавит соответствующие разрешения каждой группе

## Клиенты

- Я объединил customers, leads в одну сущность (clients).
    - Потенциальный клиент - `client.state=POTENTIAL`
    - Активный клиент - `client.state=Active`
    - Бывший клиент - `client.state=INACTIVE`
    - Контракты можно заключать и с активными клиентами (если он решил воспользоваться
      не только одной услугой например)
- Нельзя создать запись в client, если он уже там присутствует
  (уникальное поле номер телефона).
- При редактировании клиента - нельзя сменить его номер!
- Нельзя поменять состояние клиента если он active либо имеет действующий контракт (на случай, если
  где-то произошла ошибка и состояние клиента не поменялось)
- Создание контракта происходит через `HistoryAds`. Состояние клиента меняется на Active

## Проблема

- При ситуации когда приходит клиент, в прошлом уже заключавший договор -
  не будет создаваться новая запись в базе о клиенте, однако изменится его поле
  о рекламе `(ads)` и его `state`.
- Если все делать по ТЗ - этот момент также не учитывается. Для предотвращения этого
  пункта - необходимо изменить ТЗ о структуре проекта.
  **Теряется нормальная статистика по рекламе.**
- Ни 1 сущность в проекте не удаляется. Меняются только его поля либо `archived` либо `state`.
- Для реального удаления нужно обратиться к правам суперпользователя, но не рекомендуется это делать.

## Пользователи системы

- Доступ к админ панели есть у is_staff (администраторы) и у superuser
- Дополнительно можно ограничить права администраторов (если под этим понимается is_staff, а не superuser)
- is_staff в админ панели видит только ограниченные приложения, полный функционал только у суперпользователя.

## Прочее

- В файле sb_bd_crm.sql - дамп базы, заполненный небольшим набором данных. Можно загрузить себе командой
`psql -U postgres -d имя_базы_данных < sb_bd_crm.sql`, предварительно создав пустую базу  Postgres (можно создать
командой `createdb -U имя_пользователя_postgres название_базы`)
- скорее всего для корректной загрузки потребуется не выполнять команду `python manage.py create_groups`
- Присутствуют настройки для redis, celery. Каждую полночь обновляется информация об актуальности контрактов.
## Итог по техническому заданию:

| Необходимый функционал по ТЗ                                                                                                                                                         | URL:                                        |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|
| **авторизация пользователя**                                                                                                                                                         | http://127.0.0.1:8000/users/login           |
| **выход из системы**                                                                                                                                                                 | http://127.0.0.1:8000/users/logout          |
| **создание, редактирование и просмотр предоставляемых услуг;**                                                                                                                       | http://127.0.0.1:8000/products/create/      |
|                                                                                                                                                                                      | http://127.0.0.1:8000/products/6/delete/    |
|                                                                                                                                                                                      | http://127.0.0.1:8000/products/detail/6     |
|                                                                                                                                                                                      | http://127.0.0.1:8000/products/6/edit/      |
|                                                                                                                                                                                      | http://127.0.0.1:8000/products/list/        |
| **создание, редактирование и просмотр рекламной кампании;**                                                                                                                          | http://127.0.0.1:8000/ads/create/           |
|                                                                                                                                                                                      | http://127.0.0.1:8000/ads/6/delete/         |
|                                                                                                                                                                                      | http://127.0.0.1:8000/ads/detail/6          |
|                                                                                                                                                                                      | http://127.0.0.1:8000/ads/6/edit/           |
|                                                                                                                                                                                      | http://127.0.0.1:8000/ads/list/             |
| **создание, редактирование и просмотр потенциальных клиентов;**                                                                                                                      | http://127.0.0.1:8000/clients/create/       |
|                                                                                                                                                                                      | http://127.0.0.1:8000/clients/delete/6      |
|                                                                                                                                                                                      | http://127.0.0.1:8000/clients/detail/6      |
|                                                                                                                                                                                      | http://127.0.0.1:8000/edit/6                |
|                                                                                                                                                                                      | http://127.0.0.1:8000/clients/list/         |
|                                                                                                                                                                                      | http://127.0.0.1:8000/clients/list/active   |
|                                                                                                                                                                                      | http://127.0.0.1:8000/clients/list/inactive |
| **создание, редактирование и просмотр контракта для клиента;**                                                                                                                       | http://127.0.0.1:8000/contracts/create/     |
|                                                                                                                                                                                      | http://127.0.0.1:8000/contracts/6/detail    |
|                                                                                                                                                                                      | http://127.0.0.1:8000/6/delete/             |
|                                                                                                                                                                                      | http://127.0.0.1:8000/contracts/6/edit/     |
|                                                                                                                                                                                      | http://127.0.0.1:8000/contracts/list        |
| **перевод потенциального клиента в активного** - перевод выполняется при отправке формы создания контракта. Потенциальный клиент - переводится в активного ПРОГРАММНО, а не в ручную |                                             |
| подсчёт и отображение статистики по рекламным кампаниям: сколько привлечено потенциальных клиентов, сколько из них перешло в активных.                                               | http://127.0.0.1:8000/ads/statistic         |
|                                                                                                                                                                                      | http://127.0.0.1:8000/users/stat            |

## Требования к коду
| Требования к коду                                                                                                                                                                                 | Комментарий                                                                                                                                                                              |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Пользователей и роли нужно создавать с помощью стандартного административного интерфейса Django.                                                                                                  | Пользователи группы Admins имеют доступ к админ панели, но не имеют доступ к приложениям auth.user, auth,group. Только суперпользователь. Но можно исправить в приложении users/admin.py |
| Все остальные функции CRM-системы должны быть доступны вне административного интерфейса Django.                                                                                                   | Выполнено                                                                                                                                                                                |
| Нужно использовать PostgreSQL как систему управления базами данных (СУБД). О том, как установить её, вы можете узнать в инструкциях: установка на Windows, установка на Linux и настройка Django. | Выполнено                                                                                                                                                                                |
| Необходимо подключить Pylint, чтобы автоматически проверять код на соответствие стилевому оформлению. Чтобы разобраться в этом подробнее, прочитайте инструкцию по использованию для Pylint.      | Использую black и isort                                                                                                                                                                  |

## Скриншоты
### Аутентификация 
![image](https://github.com/artem-sitd/CRM/assets/22573129/9f842c0b-6e1d-46eb-baf1-1f36da19a848)

### Страница Мэнеджера
![image](https://github.com/artem-sitd/CRM/assets/22573129/4758fd9c-f244-48be-8aee-00e8ac124629)
![image](https://github.com/artem-sitd/CRM/assets/22573129/2a645ddb-5ff8-484a-b786-75e313510f0f)
![image](https://github.com/artem-sitd/CRM/assets/22573129/dca9ed80-8b30-453e-b30c-83f101b07c29)
![image](https://github.com/artem-sitd/CRM/assets/22573129/e60b34fc-fbd6-4b0a-9b9e-495380d83121)
![image](https://github.com/artem-sitd/CRM/assets/22573129/fa2d8de1-e6e8-4f2f-afe9-26042570f7a7)
![image](https://github.com/artem-sitd/CRM/assets/22573129/da891312-9679-4801-a310-f0892d81afe5)


### Создание контракта
![image](https://github.com/artem-sitd/CRM/assets/22573129/ebdcde78-17e1-4ac0-9f1f-29b167810069)
![image](https://github.com/artem-sitd/CRM/assets/22573129/6d81a7cf-4960-45fe-aa0c-4c91cdd5b520)
![image](https://github.com/artem-sitd/CRM/assets/22573129/bace4321-f6b7-4b16-89df-846766cdbbfd)


### Страница маркетолога
![image](https://github.com/artem-sitd/CRM/assets/22573129/eb4a27f1-ae3c-47d4-8269-c93865894056)
![image](https://github.com/artem-sitd/CRM/assets/22573129/04eb62f7-161f-417c-b2f6-6dd50eda8494)
![image](https://github.com/artem-sitd/CRM/assets/22573129/2383c3c3-f5c7-4599-9722-cd6eb6a82ba3)
![image](https://github.com/artem-sitd/CRM/assets/22573129/721f32f8-1842-4900-8d95-78435f0dc830)


### Создание рекламной компании
![image](https://github.com/artem-sitd/CRM/assets/22573129/46d4bd16-4035-43eb-a2b6-87e484fc50d9)


### Странциа оператора
![image](https://github.com/artem-sitd/CRM/assets/22573129/f374ac5c-3828-4864-b0e5-61b883855629)



### Админка
![image](https://github.com/artem-sitd/CRM/assets/22573129/f886e884-50f4-45bb-b195-74756d9dfd61)
![image](https://github.com/artem-sitd/CRM/assets/22573129/bd5a1587-ed99-4159-a88f-73bf960c953f)

